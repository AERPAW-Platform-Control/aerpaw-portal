{% extends 'base.html' %}
{% load static users_tags experiments_tags %}

{% block title %}
    Sessions
{% endblock %}

{% block content %}
    {% if message %}
        <div class="text-danger" style="font-size: large">{{ message }}</div>
    {% endif %}
    {% if user.is_authenticated %}
        <div class="container w-85">
            <div class="d-flex flex-row align-items-center justify-content-between">
                <h2>Sessions
                    <em class="text-primary" style="font-size: medium">
                        (experiment: {{ experiment_id|id_to_experiment_name }})
                    </em>
                </h2>
                <div>
                    <button class="btn btn-secondary mr-2" value="cancel">
                        <a href="{% url 'experiment_detail' experiment_id=experiment_id %}" class="unlink">Back</a>
                    </button>
                </div>
            </div>
            <table class="table table-striped table-bordered my-4">
                <tbody>
                <tr>
                    <th>id</th>
                    <th>Session Type</th>
                    <th>Started By </th>
                    <th>Created</th>
                    <th>Ended By</th>
                    <th>Ended </th>
                    {% for session in sessions.results %}
                        <tr>
                            <td>
                                <a href="{% url 'session_detail' experiment_id=experiment_id session_id=session.session_id %}">
                                    {{ session.session_id }}</a>
                            </td>
                            <td>{{ session.session_type}}</td>
                            <td>{{ session.started_by | id_to_username }}</td>
                            <td>{{ session.created }}</td>
                            <td>{{ session.ended_by }}</td>
                            <td>{{ session.ended_date_time }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% if debug %}
            <hr>
            <pre>{{ sessions|pprint }}</pre>
        {% endif %}
    {% else %}
        <p>You are not allowed to view this session or are not logged in</p>
        <a href="{% url 'login' %}">
            <button class="message-btn btn btn-success">Login</button>
        </a>
    {% endif %}
{% endblock %}